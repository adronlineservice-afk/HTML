<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image to Excel Converter – Free, Private, In‑Browser</title>
  <meta name="description" content="Convert tables from images to editable spreadsheets right in your browser. No upload. Free & private." />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background:#0b1016; color:#e5e7eb; }
    header, footer { max-width: 900px; margin: auto; padding: 20px; }
    main { max-width: 900px; margin: auto; padding: 20px; }
    .card { background:#121923; padding:20px; border-radius:12px; }
    .drop { border:2px dashed #38bdf8; padding:30px; text-align:center; border-radius:12px; cursor:pointer; }
    .drop.dragover { background:rgba(56,189,248,.1); }
    .preview img { max-width:100%; margin-top:15px; border-radius:8px; }
    .toolbar { margin-top:15px; display:flex; gap:10px; flex-wrap:wrap; }
    .btn { padding:10px 16px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
    .btn-primary { background:#38bdf8; color:#fff; }
    .btn-success { background:#22c55e; color:#fff; }
    .btn-danger { background:#ef4444; color:#fff; }
    table { width:100%; border-collapse: collapse; margin-top:20px; }
    th,td { border:1px solid #555; padding:6px 10px; }
    th { background:#1f2937; position:sticky; top:0; }
    td[contenteditable="true"] { background:#0f1520; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <h1>Image ➜ Excel Converter</h1>
    <p>Convert table images to editable Excel sheets — directly in your browser.</p>
  </header>

  <main>
    <div class="card">
      <label class="drop" id="drop">
        <input id="file" type="file" accept="image/*" hidden />
        Drag & drop an image here or click to browse
      </label>
      <div class="preview" id="preview"></div>
      <div class="toolbar">
        <button id="btn-ocr" class="btn btn-primary" disabled>Extract table</button>
        <button id="btn-clear" class="btn btn-danger" disabled>Clear</button>
        <button id="btn-export" class="btn btn-success" disabled>Export to Excel</button>
      </div>
      <div id="status" style="margin-top:10px; color:#94a3b8;">Ready</div>
    </div>

    <div id="results" style="display:none;">
      <h2>Recognized Table</h2>
      <table id="table">
        <thead><tr id="thead-row"></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </main>

  <footer>
    <p>⚠️ Privacy: All OCR runs locally in your browser. Nothing is uploaded.</p>
  </footer>

  <script>
    const fileInput = document.getElementById('file');
    const drop = document.getElementById('drop');
    const preview = document.getElementById('preview');
    const btnOcr = document.getElementById('btn-ocr');
    const btnClear = document.getElementById('btn-clear');
    const btnExport = document.getElementById('btn-export');
    const statusEl = document.getElementById('status');
    const results = document.getElementById('results');
    const theadRow = document.getElementById('thead-row');
    const tbody = document.getElementById('tbody');

    let currentFile = null;

    drop.addEventListener('click', () => fileInput.click());
    drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('dragover'); });
    drop.addEventListener('dragleave', ()=> drop.classList.remove('dragover'));
    drop.addEventListener('drop', e=>{
      e.preventDefault(); drop.classList.remove('dragover');
      if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener('change', e=>{
      if (e.target.files[0]) handleFile(e.target.files[0]);
    });

    function handleFile(file) {
      if (!file.type.startsWith('image/')) { alert('Please select an image file.'); return; }
      currentFile = file;
      preview.innerHTML = `<img src="${URL.createObjectURL(file)}" alt="preview">`;
      btnOcr.disabled = false;
      btnClear.disabled = false;
      btnExport.disabled = true;
      results.style.display = 'none';
      statusEl.textContent = 'Image loaded, ready to extract.';
    }

    btnClear.addEventListener('click', ()=>{
      currentFile = null;
      preview.innerHTML = '';
      fileInput.value = '';
      btnOcr.disabled = true;
      btnClear.disabled = true;
      btnExport.disabled = true;
      results.style.display = 'none';
      theadRow.innerHTML = '';
      tbody.innerHTML = '';
      statusEl.textContent = 'Cleared.';
    });

    btnOcr.addEventListener('click', async ()=>{
      if (!currentFile) return;
      statusEl.textContent = 'Loading OCR engine…';

      try {
        const worker = await Tesseract.createWorker({
          logger: m => { if(m.status) statusEl.textContent = m.status + (m.progress ? ` ${(m.progress*100).toFixed(0)}%` : ''); }
        });
        await worker.loadLanguage('eng');
        await worker.initialize('eng');

        const { data } = await worker.recognize(currentFile);
        await worker.terminate();

        const table = textToTable(data.text);
        renderTable(table);
        results.style.display = 'block';
        btnExport.disabled = false;
        statusEl.textContent = 'Done! Review and export when ready.';
      } catch(err) {
        console.error(err);
        alert('OCR failed. Try a clearer image or crop tighter around the table.');
        statusEl.textContent = 'Error during OCR.';
        btnOcr.disabled = false;
      }
    });

    btnExport.addEventListener('click', ()=>{
      const wb = XLSX.utils.table_to_book(document.getElementById('table'), { sheet:"Sheet1" });
      XLSX.writeFile(wb, `image-to-excel-${Date.now()}.xlsx`);
    });

    function textToTable(text){
      const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      if(!lines.length) return [[]];
      const rows = lines.map(l => l.includes('\t') ? l.split('\t') : l.split(/\s{2,}/));
      return rows;
    }

    function renderTable(data){
      theadRow.innerHTML = '';
      tbody.innerHTML = '';
      if (!data.length) return;
      data[0].forEach((h,i)=>{
        const th=document.createElement('th');
        th.textContent = h || `Column ${i+1}`;
        theadRow.appendChild(th);
      });
      data.slice(1).forEach(row=>{
        const tr=document.createElement('tr');
        row.forEach(cell=>{
          const td=document.createElement('td');
          td.contentEditable='true';
          td.textContent=cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
