<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image to Excel Converter – Free, Private, In‑Browser</title>
  <meta name="description" content="Convert tables from images to editable spreadsheets right in your browser. No upload. Free & private." />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <style>
    :root {
      --bg: #0b1016;
      --card: #121923;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --brand: #38bdf8;
      --accent: #22c55e;
      --danger: #ef4444;
      --ring: rgba(56,189,248,.35);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 20% -10%, #0e1622 0%, var(--bg) 40%) no-repeat fixed;
      color: var(--text);
      line-height: 1.5;
    }
    header {
      max-width: 1100px; margin: 0 auto; padding: 32px 20px 12px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .logo { display: inline-flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text); }
    .logo-badge { width: 38px; height: 38px; border-radius: 12px; background: linear-gradient(135deg, var(--brand), #7c3aed); display: grid; place-items: center; box-shadow: 0 10px 30px rgba(56,189,248,.2); }
    .logo-badge svg { filter: drop-shadow(0 2px 8px rgba(0,0,0,.4)); }
    .logo span { font-weight: 700; font-size: 1.05rem; letter-spacing: .2px; }

    .cta-row { display: flex; gap: 10px; align-items: center; }
    .btn {
      appearance: none; border: none; cursor: pointer; color: white; background: #1f2937;
      padding: 10px 14px; border-radius: 12px; font-weight: 600; transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn-primary { background: linear-gradient(135deg, var(--brand), #7c3aed); box-shadow: 0 10px 24px rgba(56,189,248,.25); }
    .btn-success { background: linear-gradient(135deg, var(--accent), #16a34a); box-shadow: 0 10px 24px rgba(34,197,94,.22); }
    .btn-ghost { background: transparent; border: 1px solid rgba(148,163,184,.25); color: var(--muted); }

    main { max-width: 1100px; margin: 0 auto; padding: 12px 20px 48px; }

    .hero { display: grid; grid-template-columns: 1.1fr .9fr; gap: 24px; align-items: center; }
    @media (max-width: 920px) { .hero { grid-template-columns: 1fr; } }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) padding-box,
                  radial-gradient(600px 300px at 10% -10%, rgba(56,189,248,.25), rgba(124,58,237,.05)) border-box;
      border: 1px solid rgba(148,163,184,.18);
      border-radius: var(--radius);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.04), 0 20px 60px rgba(2,6,23,.5);
    }

    .drop {
      padding: 24px; text-align: center; border: 2px dashed rgba(148,163,184,.35); border-radius: calc(var(--radius) - 6px);
      display: grid; place-items: center; gap: 14px; min-height: 260px;
    }
    .drop.dragover { border-color: var(--brand); box-shadow: 0 0 0 6px var(--ring); }
    .drop input { display: none; }

    .helper { color: var(--muted); font-size: .95rem; }

    .preview {
      padding: 18px; display: grid; grid-template-columns: 1fr; gap: 12px; max-height: 420px; overflow: auto;
      border-top: 1px dashed rgba(148,163,184,.2);
    }

    .img-wrap { position: relative; display: inline-block; }
    .img-wrap img { max-width: 100%; border-radius: 12px; display: block; }

    .toolbar { display: flex; flex-wrap: wrap; gap: 10px; padding: 14px; border-top: 1px solid rgba(148,163,184,.18); align-items: center; justify-content: space-between; }

    .progress { height: 10px; background: rgba(148,163,184,.18); border-radius: 20px; overflow: hidden; }
    .progress > div { height: 100%; width: 0%; background: linear-gradient(90deg, var(--brand), #7c3aed); transition: width .2s ease; }
    .status { color: var(--muted); font-size: .9rem; }

    .results { margin-top: 24px; }
    table { width: 100%; border-collapse: collapse; background: #0f1520; border: 1px solid rgba(148,163,184,.18); border-radius: 12px; overflow: hidden; }
    thead th { position: sticky; top: 0; background: rgba(15,21,32,.9); backdrop-filter: blur(6px); }
    th, td { padding: 10px 12px; border-bottom: 1px solid rgba(148,163,184,.12); }
    tbody tr:hover td { background: rgba(56,189,248,.06); }
    td[contenteditable="true"] { outline: none; }

    .badgelike { display: inline-flex; align-items: center; gap: 8px; font-size: .9rem; color: var(--muted); }
    .badgelike svg { opacity: .85; }

    footer { max-width: 1100px; margin: 24px auto 60px; padding: 0 20px; color: var(--muted); font-size: .9rem; }
    footer a { color: var(--brand); text-decoration: none; }
  </style>
  <!-- Tesseract OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js" defer></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
</head>
<body>
  <header>
    <a class="logo" href="#" aria-label="Home">
      <span class="logo-badge" aria-hidden="true">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 4h10a3 3 0 0 1 3 3v1h3a0 0 0 0 1 0 0v9a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V4z" stroke="white" stroke-opacity=".9" stroke-width="1.6"/>
          <path d="M8 12h8" stroke="white" stroke-opacity=".9" stroke-width="1.6" stroke-linecap="round"/>
          <path d="M8 16h5" stroke="white" stroke-opacity=".9" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <span>Image ➜ Excel</span>
    </a>
    <div class="cta-row">
      <button id="btn-how" class="btn btn-ghost" type="button">How it works</button>
      <a class="btn btn-primary" href="#converter">Try it now</a>
    </div>
  </header>

  <main>
    <section class="hero">
      <div>
        <h1 style="font-size: clamp(1.8rem, 3vw, 2.6rem); margin: 0 0 10px;">Convert table images to Excel — privately, in your browser</h1>
        <p class="helper" style="max-width: 62ch;">Drop a screenshot or photo containing a table. We’ll run on‑device OCR to turn it into an editable sheet you can fix up and export as <strong>.xlsx</strong>. Nothing leaves your computer.</p>
        <div class="badgelike" style="margin-top: 14px;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2l3 7h7l-5.5 4.1L18 21l-6-4-6 4 1.5-7.9L2 9h7l3-7z" stroke="currentColor" stroke-width="1.5"/></svg>
          No upload • Free • Open libraries
        </div>
      </div>
      <div id="converter" class="card">
        <label class="drop" id="drop">
          <input id="file" type="file" accept="image/png,image/jpeg,image/webp,image/bmp" />
          <div>
            <h3 style="margin: 0 0 6px;">Drag & drop an image here</h3>
            <p class="helper">or click to browse — JPG, PNG, WEBP, BMP</p>
          </div>
        </label>
        <div class="preview" id="preview" hidden></div>
        <div class="toolbar">
          <div style="display:flex; gap:10px; align-items:center;">
            <button id="btn-ocr" class="btn btn-primary" type="button" disabled>Extract table</button>
            <button id="btn-clear" class="btn" type="button" disabled>Clear</button>
            <button id="btn-export" class="btn btn-success" type="button" disabled>Export to Excel</button>
          </div>
          <div style="flex:1; display:grid; gap:8px;">
            <div class="progress" aria-hidden="true"><div id="bar"></div></div>
            <div id="status" class="status">Ready</div>
          </div>
        </div>
      </div>
    </section>

    <section class="results" id="results" hidden>
      <h2 style="font-size: 1.2rem; margin: 0 0 12px;">Recognized Table (editable)</h2>
      <div class="card" style="padding: 10px;">
        <div style="overflow:auto;">
          <table id="table">
            <thead><tr id="thead-row"></tr></thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
      <p class="helper" style="margin-top:10px;">Tip: Double‑click any cell to edit. Use <em>Export to Excel</em> when you’re happy.</p>
    </section>
  </main>

  <footer>
    <p><strong>Privacy:</strong> All processing runs locally in your browser using WebAssembly (Tesseract.js & SheetJS). Your images and data are not uploaded to any server.</p>
    <p>Made with ❤️ using open‑source. You can customize this page text and styles freely.</p>
  </footer>

  <script>
    const fileInput = document.getElementById('file');
    const drop = document.getElementById('drop');
    const preview = document.getElementById('preview');
    const btnOcr = document.getElementById('btn-ocr');
    const btnClear = document.getElementById('btn-clear');
    const btnExport = document.getElementById('btn-export');
    const bar = document.getElementById('bar');
    const statusEl = document.getElementById('status');
    const results = document.getElementById('results');
    const theadRow = document.getElementById('thead-row');
    const tbody = document.getElementById('tbody');

    let currentImageBlob = null;

    // --- Drag & drop handlers
    ;['dragenter','dragover'].forEach(evt => drop.addEventListener(evt, e=>{ e.preventDefault(); drop.classList.add('dragover'); }));
    ;['dragleave','drop'].forEach(evt => drop.addEventListener(evt, e=>{ e.preventDefault(); drop.classList.remove('dragover'); }));
    drop.addEventListener('drop', (e) => {
      const f = e.dataTransfer.files?.[0];
      if (f) handleFile(f);
    });
    drop.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files?.[0];
      if (f) handleFile(f);
    });

    function handleFile(file) {
      if (!file.type.startsWith('image/')) { alert('Please drop an image file.'); return; }
      currentImageBlob = file;
      preview.innerHTML = '';
      const img = document.createElement('img');
      img.alt = 'Preview';
      img.loading = 'lazy';
      img.src = URL.createObjectURL(file);
      const wrap = document.createElement('div');
      wrap.className = 'img-wrap';
      wrap.appendChild(img);
      preview.appendChild(wrap);
      preview.hidden = false;
      btnOcr.disabled = false;
      btnClear.disabled = false;
      btnExport.disabled = true;
      results.hidden = true;
      bar.style.width = '0%';
      statusEl.textContent = 'Ready to extract.';
    }

    btnClear.addEventListener('click', () => {
      fileInput.value = '';
      preview.hidden = true; preview.innerHTML = '';
      currentImageBlob = null;
      btnOcr.disabled = true; btnClear.disabled = true; btnExport.disabled = true;
      results.hidden = true; theadRow.innerHTML = ''; tbody.innerHTML = '';
      bar.style.width = '0%'; statusEl.textContent = 'Cleared.';
    });

    btnOcr.addEventListener('click', async () => {
      if (!currentImageBlob) return;
      btnOcr.disabled = true; btnExport.disabled = true;
      statusEl.textContent = 'Loading OCR engine…';

      try {
        const { createWorker } = Tesseract;
        const worker = await createWorker('eng', 1, {
          logger: (m) => {
            if (m.status) statusEl.textContent = m.status + (m.progress ? ` ${(m.progress*100).toFixed(0)}%` : '');
            if (m.progress != null) bar.style.width = `${Math.max(2, m.progress*100)}%`;
          },
        });

        const image = await blobToImageBitmap(currentImageBlob);
        statusEl.textContent = 'Recognizing text…';
        const { data } = await worker.recognize(image);
        await worker.terminate();

        const table = textToTable(data.text);
        renderTable(table);
        results.hidden = false;
        btnExport.disabled = false;
        statusEl.textContent = 'Done. Review & export when ready.';
      } catch (err) {
        console.error(err);
        alert('OCR failed. Try a clearer image or crop tighter around the table.');
        statusEl.textContent = 'Error during OCR.';
        btnOcr.disabled = false;
      }
    });

    btnExport.addEventListener('click', () => {
      const tableEl = document.getElementById('table');
      const wb = XLSX.utils.table_to_book(tableEl, { sheet: 'Sheet1' });
      const fname = `image-to-excel-${new Date().toISOString().slice(0,10)}.xlsx`;
      XLSX.writeFile(wb, fname);
    });

    function blobToImageBitmap(blob) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => {
          // Draw to canvas to ensure Bitmap format
          const canvas = document.createElement('canvas');
          const scale = Math.min(1.5, 1600 / Math.max(img.width, img.height)); // downscale huge images a bit
          canvas.width = Math.floor(img.width * scale);
          canvas.height = Math.floor(img.height * scale);
          const ctx = canvas.getContext('2d');
          ctx.imageSmoothingEnabled = true;
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          canvas.toBlob((b)=>{
            createImageBitmap(b).then(resolve).catch(reject);
          }, 'image/png', 0.95);
        };
        img.onerror = reject;
        img.src = URL.createObjectURL(blob);
      });
    }

    // Heuristic: turn OCR text into a 2D array by splitting rows and columns.
    function textToTable(text) {
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      if (!lines.length) return [[]];
      // If tabs exist, prefer them. Otherwise split on 2+ spaces.
      const rows = lines.map(l => l.includes('\t') ? l.split('\t') : l.split(/\s{2,}/));
      // Normalize row width using the most common column count.
      const counts = {};
      rows.forEach(r => counts[r.length] = (counts[r.length]||0)+1);
      const commonCols = Number(Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0]);
      const normalized = rows.map(r => {
        if (r.length === commonCols) return r;
        if (r.length > commonCols) return r.slice(0, commonCols);
        while (r.length < commonCols) r.push('');
        return r;
      });
      // Use first row as header if it looks like labels (no numeric majority)
      return normalized;
    }

    function renderTable(data) {
      theadRow.innerHTML = '';
      tbody.innerHTML = '';
      if (!data || !data.length) return;
      const header = data[0];
      header.forEach((h, i) => {
        const th = document.createElement('th');
        th.textContent = h || `Column ${i+1}`;
        theadRow.appendChild(th);
      });
      data.slice(1).forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.contentEditable = 'true';
          td.textContent = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    // Simple help modal (no dependency)
    document.getElementById('btn-how').addEventListener('click', ()=>{
      alert('1) Drop a clear image of a table.\n2) Click "Extract table" to run on‑device OCR.\n3) Review & edit cells.\n4) Click "Export to Excel" to download an .xlsx file.\n\nTips: Crop tightly, use sharp images, prefer screenshots over photos.');
    });
  </script>
</body>
</html>
